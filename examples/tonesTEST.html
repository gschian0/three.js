<!DOCTYPE html>
<html lang="en">
	<head>
		
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link type="text/css" rel="stylesheet" href="main.css">
	</head>
	<body>
        <body>
            <div id="overlay">
              <button id="startButton">Enter The Tone Matrix</button>
            </div>

		<div id="webGL"></div>
		<div id="info">
		
		</div>

        <script src='/build/three.js'></script>
        <!-- <script src='/libs/threex.domevents.js'></script> -->
      <script src='https://s3-us-west-2.amazonaws.com/s.cdpn.io/2666677/CurveExtras.js'></script>
      <script src='https://s3-us-west-2.amazonaws.com/s.cdpn.io/2666677/OrbitControls.js'></script>
      <script src='/examples/js/controls/FirstPersonControls.js'></script>
      <script src='https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.6/dat.gui.min.js'></script>

		<script type="module">


var scene, camera, renderer, mesh, group, clock, controls;
var listener = new THREE.AudioListener();
var oscillator = [];
var gain = [];
let sphere = [];
let testMesh;
// let sound = [];	
const startButton = document.getElementById( 'startButton' );
			startButton.addEventListener( 'click', function () {

				init();
        update();
        // listener.context.start();

			}, false );

// init();

function init(){
    const overlay = document.getElementById( 'overlay' );
	overlay.remove();
 // context = new AudioContext;

  scene = new THREE.Scene();
  scene.background = new THREE.Color(0xff0000);
 
  
  clock = new THREE.Clock();
  
  camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 0.1, 1000 );
  camera.position.set(0, 0, 100);
  camera.add( listener );
  
  const ambient = new THREE.HemisphereLight(0xffffbb, 0x080820);
  scene.add(ambient);
  
  const light = new THREE.DirectionalLight(0xFFFFFF, 1);
  light.position.set( 1, 10, 6);
  scene.add(light);
  
  renderer = new THREE.WebGLRenderer({antialias: true});
  
 
  renderer.setSize( window.innerWidth, window.innerHeight );
  document.body.appendChild( renderer.domElement );

  const controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.target.set(0, 0, 0);
  controls.enableDamping = true;
  controls.dampingFactor = 0.1;
  controls.rotateSpeed = 0.04;
  controls.maxDistance = Infinity;

  let testGeo = new THREE.BoxBufferGeometry(20,20,20);
  let testMat = new THREE.MeshNormalMaterial();
  testMesh = new THREE.Mesh(testGeo,testMat);
  //testMesh.rotation.y = 90;
  //testMesh.rotation.z = 30;
  let sound = new THREE.PositionalAudio(listener)
  testMesh.add(sound);
  let gain = listener.context.createGain();
  let oscillator = listener.context.createOscillator();
  oscillator.type = 'sawtooth';
  oscillator.frequency.setTargetAtTime = 100;
  oscillator.connect(gain);
  sound.setVolume(0.5);
  sound.setNodeSource(gain);
  gain.gain.setTargetAtTime(0.5, listener.context.currentTime+ 5, 10);
  sound.setRefDistance(20);
  sound.setDirectionalCone( 30, 180, 0.1 );
  testMesh.add(sound);
  testMesh.name = 'mesh1'
  oscillator.start(1.5);

  
  
  
  
  
  listener.setMasterVolume(0.25);
  
  scene.add(testMesh);



 
 

//   var mouse	= {x : 0, y : 0}
// 	document.addEventListener('click', function(event){
// 		context.resume();
// 	}, true)
  
  
  window.addEventListener( 'resize', resize, false);

  
  // onclick(camera,renderer,listener);


  
  
  // update();
}



function updateMesh(){
    
 const time = clock.getElapsedTime();
 //var testMesh =scene.getObjectByName('mesh1');
 //testMesh.rotation.y += 0.1;

}

function update(){
  requestAnimationFrame( update );
  updateMesh();
  
	renderer.render( scene, camera );  
}

function resize(){
    controls.handleResize();
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize( window.innerWidth, window.innerHeight );
}
 
		</script>
	</body>
</html>
